@model Lab2_ImageService.Models.ImageModel

@{
    ViewData["Title"] = "Analyzed Images";
    var objectsImages = ViewData["ObjectsImages"] as List<ImageModel>;
    var thumbnailsImages = ViewData["ThumbnailsImages"] as List<ImageModel>;
    var uploadedImages = ViewData["UploadedImages"] as List<ImageModel>;

    var totalPages = (int?)ViewBag.TotalPages;
    var currentPage = (int?)ViewBag.CurrentPage;

    var download = "Download";

    // Create a list for the latest analyzed images
    var latestOriginalImage = new List<ImageModel>();
    var latestThumbnail = new List<ImageModel>();
    var latestObject = new List<ImageModel>();

    // Add the latest uploaded image to the list
    if (uploadedImages.Count > 0)
    {
        latestOriginalImage.Add(uploadedImages.First());
    }

    // Add the latest thumbnail image to the list
    if (thumbnailsImages.Count > 0)
    {
        latestThumbnail.Add(thumbnailsImages.First());
    }

    // Add the latest object image to the list
    if (objectsImages.Count > 0)
    {
        latestObject.Add(objectsImages.First());
    }
}

<div class="content">
    <div class="">
        <div class="text-center">
            <!-- Buttons to toggle image categories -->
            <button id="showUploadedImages">Show Uploaded Images</button>
            <button id="showThumbnails">Show Thumbnails</button>
            <button id="showObjectImages">Show Objects Images</button>
        </div>

        <div class="latest-image" style="display: ;">
            <!-- Display uploaded images -->
            <h3 class="text-white">Latest analyzed image</h3>
            <div class="row justify-content-center">
                @if (ViewData["LatestAnalyzedImages"] != null)
                {
                    foreach (var image in latestOriginalImage)
                    {
                        <div class="col-md-2 mb-3">
                            <div class="card">
                                <img src="~/UploadedImages/@image.FileName" class="img-thumbnail img-fluid" alt="Uploaded Image" style="height: 200px;">
                                <div class="card-body d-flex flex-column" style="height: 120px;">
                                    <p>Uploaded: @image.UploadedTimestamp.ToString("yyyy-MM-dd HH:mm")</p>
                                    <a href="~/UploadedImages/@image.FileName" download="@image.FileName" class="">@download</a>
                                </div>
                            </div>
                        </div>
                    }

                    @foreach (var image in latestThumbnail)
                    {
                        <div class="col-md-2 mb-3">
                            <div class="card">
                                <img src="~/Thumbnails/@image.FileName" class="img-thumbnail img-fluid" alt="Thumbnail Image" style="height: 200px;">
                                <div class="card-body d-flex flex-column" style="height: 120px;">
                                    <p>Uploaded: @image.UploadedTimestamp.ToString("yyyy-MM-dd HH:mm")</p>
                                    <a href="~/Thumbnails/@image.FileName" download="@image.FileName" class="">@download</a>
                                </div>
                            </div>
                        </div>
                    }

                    @foreach (var image in latestObject)
                    {
                        <div class="col-md-2 mb-3">
                            <div class="card">
                                <img src="~/Objects/@image.FileName" class="img-thumbnail img-fluid" alt="Object Image" style="height: 200px;">
                                <div class="card-body d-flex flex-column" style="height: 120px;">
                                    <p>Uploaded: @image.UploadedTimestamp.ToString("yyyy-MM-dd HH:mm")</p>
                                    <a href="~/Objects/@image.FileName" download="@image.FileName" class="">@download</a>
                                </div>
                            </div>
                        </div>
                    }


                }
            </div>
        </div>

        <!-- Uploaded Images -->
        <div class="uploaded-images" style="display: none;" id="uploadedImagesDiv">
            <!-- Display uploaded images -->
            <div class="text-center mb-3 mt-3">
                <h3 class="text-white">Uploaded Images</h3>
                <button href="#" class="backTopBtn" onclick="scrollToTop()">Back to Top</button>
            </div>
            <div class="row">
                @foreach (var image in uploadedImages)
                {
                    <div class="col-md-2 mb-3">
                        <div class="card">
                            <img src="~/UploadedImages/@image.FileName" class="img-thumbnail img-fluid" alt="Object Image" style="height: 200px;">
                            <div class="card-body d-flex flex-column" style="height: 120px;">

                                <a href="~/UploadedImages/@image.FileName" download="@image.FileName" class="">@download</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Thumbnails Images -->
        <div class="thumbnails" style="display: none;" id="thumbnailsDiv">
            <!-- Display thumbnail images -->
            <div class="text-center mb-3 mt-3">
                <h3 class="text-white">Uploaded Images</h3>
                <button href="#" class="backTopBtn" onclick="scrollToTop()">Back to Top</button>
            </div>
            <div class="row">
                @foreach (var image in thumbnailsImages)
                {
                    <div class="col-md-2 mb-3">
                        <div class="card">
                            <img src="~/Thumbnails/@image.FileName" class="img-thumbnail img-fluid" alt="Thumbnail Image" style="height: 200px;">
                            <div class="card-body d-flex flex-column" style="height: 120px;">

                                <a href="~/Thumbnails/@image.FileName" download="@image.FileName" class="">@download</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Objects Images -->
        <div class="object-images" style="display: none;" id="objectImagesDiv">
            <!-- Display object images -->
            <div class="text-center mb-3 mt-3">
                <h3 class="text-white">Uploaded Images</h3>
                <button href="#" class="backTopBtn" onclick="scrollToTop()">Back to Top</button>
            </div>
            
            <div class="row">
                @foreach (var image in objectsImages)
                {
                    <div class="col-md-3 mb-3">
                        <div class="card">
                            <img src="~/Objects/@image.FileName" class="img-thumbnail img-fluid" alt="Uploaded Image" style="height: 200px;">
                            <div class="card-body d-flex flex-column" style="height: 120px;">

                                <a href="~/Objects/@image.FileName" download="@image.FileName" class="">@download</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- The Modal for images-->
<div id="myModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage">
</div>


<script>
    // Get the modal element and close button
    var modal = document.getElementById('myModal');
    var modalImage = document.getElementById('modalImage');
    var closeBtn = document.getElementsByClassName('close')[0];

    // Function to open the modal and set the image source
    function openModal(imageSrc) {
        modal.style.display = 'block';
        modalImage.src = imageSrc;
    }

    // Function to close the modal
    function closeModal() {
        modal.style.display = 'none';
    }

    // Attach click event handlers to the images
    var images = document.querySelectorAll('.img-thumbnail');

    images.forEach(function (image) {
        image.addEventListener('click', function () {
            openModal(this.src);
        });
    });

    // Attach click event handler to close button
    closeBtn.addEventListener('click', closeModal);

    // Close the modal when the user clicks outside of it
    window.addEventListener('click', function (event) {
        if (event.target == modal) {
            closeModal();
        }
    });
</script>


<script>
    // Function to scroll to the top of the page
    function scrollToTop() {
        $('html, body').animate({ scrollTop: 0 }, 200); // 1000 milliseconds (1 second) for smooth scrolling
        // Hide other image categories
        $(".thumbnails").hide();
        $(".object-images").hide();
        $(".uploaded-images").hide();
    }
</script>

<!-- JavaScript/jQuery code to toggle visibility -->
<script>
    $(document).ready(function () {
        // Function to scroll to a specific div
        function scrollToDiv(divId) {
            $('html, body').animate({
                scrollTop: $(divId).offset().top
            }, 1000); // 1000 milliseconds (1 second) for smooth scrolling
        }

        // Show Uploaded Images and scroll to the Uploaded Images div
        $("#showUploadedImages").click(function () {
            // Hide other image categories
            $(".thumbnails").hide();
            $(".object-images").hide();

            // Toggle the visibility of the Uploaded Images category
            $(".uploaded-images").toggle();

            // Scroll to the Uploaded Images div
            scrollToDiv("#uploadedImagesDiv");
        });

        // Show Thumbnails and scroll to the Thumbnails div
        $("#showThumbnails").click(function () {
            // Hide other image categories
            $(".uploaded-images").hide();
            $(".object-images").hide();

            // Toggle the visibility of the Thumbnails category
            $(".thumbnails").toggle();

            // Scroll to the Thumbnails div
            scrollToDiv("#thumbnailsDiv");
        });

        // Show Objects Images and scroll to the Objects Images div
        $("#showObjectImages").click(function () {
            // Hide other image categories
            $(".uploaded-images").hide();
            $(".thumbnails").hide();

            // Toggle the visibility of the Object Images category
            $(".object-images").toggle();

            // Scroll to the Object Images div
            scrollToDiv("#objectImagesDiv");
        });
    });
</script>


